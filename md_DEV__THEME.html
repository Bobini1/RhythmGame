<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>RhythmGame: Theme Development</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">RhythmGame<span id="projectnumber">&#160;1.0.3</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">Theme Development</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md25"></a> If you want to edit a theme, you only need a text editor. Edit the scripts and relaunch the game to see your changes.</p>
<p>All errors are printed to log.txt in the data folder. On platforms other than Windows, the log is printed to the console as well. You can also press F10 in-game to open the log overlay.</p>
<h1><a class="anchor" id="autotoc_md26"></a>
Theme structure</h1>
<p>A theme is a folder in <code>data/themes/</code> that contains a <code>theme.json</code> file. That file needs to have a <code>scripts</code> field with an object containing relative paths to QML files for each game screen implemented by the theme.</p>
<p>Here is an example of a minimal <code>theme.json</code> file:</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    &quot;scripts&quot;: {</div>
<div class="line">        &quot;result&quot;: &quot;result.qml&quot;</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p>A theme does not need to implement all screens, it can just implement the ones you want. You can think of it as a package that can contain replacements for any number of the game's screens.</p>
<h3><a class="anchor" id="autotoc_md27"></a>
Persisent settings</h3>
<p>To provide configurable theme settings that will be stored separately for each user profile, you can define a <code>settings</code> field in <code>theme.json</code>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    &quot;scripts&quot;: {</div>
<div class="line">        &quot;result&quot;: &quot;result.qml&quot;</div>
<div class="line">    },</div>
<div class="line">    &quot;settings&quot;: {</div>
<div class="line">        &quot;result&quot;: &quot;result.json&quot;</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p>It serves two purposes</p><ul>
<li>Defines variables of the screen</li>
<li>Is used for generating a settings page in the settings screen</li>
</ul>
<p>For persistent global settings affecting all profiles, you can use the <a href="https://doc.qt.io/qt-6/qml-qt-labs-settings-settings.html">Settings QML type</a>. But you probably won't need it. I only ever used it once, for storing screen resolution.</p>
<p>There are 7 different types of properties you can use in a settings file:</p><ul>
<li>boolean</li>
<li>range</li>
<li>string</li>
<li>file</li>
<li>choice</li>
<li>color</li>
<li>hidden</li>
</ul>
<p>You can also put them in groups that have names and descriptions.</p>
<p>The usage of most property types is self-explanatory, simply take a look at the default theme to find out how to use them.</p>
<p>The special <code>hidden</code> type can be used to declare properties that will not be shown in the auto-generated settings page.</p>
<p>You can access the values assigned to properties via <code>profile.vars.themeVars[screen][themeName].varId</code>.</p>
<p>You can get the current theme's name with <a href="https://bobini1.github.io/RhythmGame/classqml__components_1_1QmlUtilsAttached.html">QmlUtils.themeName</a>. As for <code>screen</code>, your theme should be able to figure it out on its own. It can be <code>"result"</code>, <code>"k7"</code>, etc.</p>
<hr  />
<p> <b>NOTE</b></p>
<p>You should not hard-code the name of your theme anywhere in your theme. The actual name of a theme in the game is always the name of its folder. Your theme should not break if a user renames the folder. Use <code>QmlUtils.themeName</code>.</p>
<hr  />
<p>Please don't access vars that don't belong to the current screen. It creates hidden dependencies on other themes or screens of your theme that might not be enabled.</p>
<p>If you need to pass a variable between screens, suggest adding it to <code>profile.vars.generalVars</code> in the engine.</p>
<h3><a class="anchor" id="autotoc_md30"></a>
Overriding the settings page for a screen</h3>
<p>You can override the auto-generated settings page for a screen by providing a QML file in a <code>settingsScripts</code> field in <code>theme.json</code>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    &quot;scripts&quot;: {</div>
<div class="line">        &quot;result&quot;: &quot;result.qml&quot;</div>
<div class="line">    },</div>
<div class="line">    &quot;settings&quot;: {</div>
<div class="line">        &quot;result&quot;: &quot;result.json&quot;</div>
<div class="line">    },</div>
<div class="line">    &quot;settingsScripts&quot;: {</div>
<div class="line">        &quot;result&quot;: &quot;resultSettings.qml&quot;</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p>The default theme does not use this feature.</p>
<h3><a class="anchor" id="autotoc_md31"></a>
Translations</h3>
<p>Translations are described in <a class="el" href="md_DEV__LANG.html">DEV_LANG.md</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    &quot;scripts&quot;: {</div>
<div class="line">        &quot;result&quot;: &quot;result.qml&quot;</div>
<div class="line">    },</div>
<div class="line">    &quot;settings&quot;: {</div>
<div class="line">        &quot;result&quot;: &quot;result.json&quot;</div>
<div class="line">    },</div>
<div class="line">    &quot;settingsScripts&quot;: {</div>
<div class="line">        &quot;result&quot;: &quot;resultSettings.qml&quot;</div>
<div class="line">    },</div>
<div class="line">    &quot;translations&quot;: {</div>
<div class="line">        &quot;en&quot;: &quot;en.qm&quot;,</div>
<div class="line">        &quot;pl&quot;: &quot;pl.qm&quot;</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md32"></a>
Theme loading</h2>
<p>Themes are loaded and validated when the game starts. If there are any critical errors in configuration files, the game will fail to start. Don't share broken themes! Look at log.txt in the data folder to find out what went wrong.</p>
<p>The part of the game that manages the theme most directly is <a href="https://github.com/Bobini1/RhythmGame/blob/master/RhythmGameQml/ContentFrame.qml">RhythmGameQml/ContentFrame.qml</a>. That qml file is compiled into the executable and is not part of any theme. It contains the window of the entire game and the <code>sceneStack</code>. <code>sceneStack</code> is a globally accessible <a href="https://doc.qt.io/qt-6/qml-qtquick-controls-stackview.html">StackView</a> that contains screens, like <code>main</code>, <code>select</code>, <code>k7</code>, one on top of the other. You can go to another screen by pushing it to the stack. You can exit a screen by popping it from the stack.</p>
<hr  />
<p> <b>NOTE</b></p>
<p>When going from <code>select</code> to <code>k7</code> and then <code>result</code>, the former screens are not destroyed. When going back from <code>result</code>, it is the responsibility of the <code>k7</code> screen to remove itself from the stack to go back to select. When <code>k7</code> pushes <code>result</code>, it should remember to remove itself when it becomes active again.</p>
<p>In most scenarios, you will want to push at most one screen on top of the stack at once. Then that screen can push another screen on top of itself, if needed.</p>
<p>Do not remove screens from under yourself. It's messy and unnecessary.</p>
<hr  />
<h2><a class="anchor" id="autotoc_md35"></a>
Initial state of screens</h2>
<p><code>sceneStack</code> contains a few helper methods:</p>
<div class="fragment"><div class="line">function openChart(path, profile1, autoplay1, score1, profile2, autoplay2, score2)</div>
<div class="line">function openCourse(course, profile1, autoplay1, score1, profile2, autoplay2, score2)</div>
<div class="line">function openResult(scores, profiles, chartData)</div>
<div class="line">function openCourseResult(scores, profiles, chartDatas, course)</div>
</div><!-- fragment --><p>Since gameplay screens and result screens need to be pushed with some initial property state, those helper methods set them based on the parameters passed to them.</p>
<p>See <a href="https://bobini1.github.io/RhythmGame/classqml__components_1_1ChartLoader.html">ChartLoader docs</a> for an explanation of the parameters of <code>openChart</code> and <code>openCourse</code>.</p>
<p>To use those methods, simply call <code>sceneStack.openChart(...)</code> from anywhere in your theme.</p>
<p>Keep the folowing in mind when writing screens with initial state:</p>
<p>Screens <code>k7</code>, <code>k14</code> and <code>k7battle</code> are expected to have single <code>var</code> property called <code>chart</code>. The assigned <code>chart</code> will be either a <a href="https://bobini1.github.io/RhythmGame/classgameplay__logic_1_1ChartRunner.html">ChartRunner</a> or <a href="https://bobini1.github.io/RhythmGame/classgameplay__logic_1_1CourseRunner.html">CourseRunner</a> object, depending on whether the player is playing a single chart or a course.</p>
<p>Screen <code>result</code> is expected to have the following properties: </p><div class="fragment"><div class="line">property list&lt;BmsScore&gt; scores</div>
<div class="line">property list&lt;Profile&gt; profiles</div>
<div class="line">property ChartData chartData</div>
</div><!-- fragment --><p>The lists will have 1 or 2 elements, depending on whether the game was played solo or in battle mode.</p>
<p>Screen <code>courseResult</code> is expected to have the following properties: </p><div class="fragment"><div class="line">property list&lt;BmsScoreCourse&gt; scores</div>
<div class="line">property list&lt;Profile&gt; profiles</div>
<div class="line">property list&lt;ChartData&gt; chartDatas</div>
<div class="line">property course course</div>
</div><!-- fragment --><p>You can always use <code>var</code> instead of the exact type if you want to be flexible.</p>
<h2><a class="anchor" id="autotoc_md36"></a>
Input</h2>
<p>It would be best if your theme supported mouse, keyboard and controller navigation. For example, for scrolling a list of songs, it would be best to allow using the mouse wheel, arrow keys and scratch. In the default theme, the <code>settings</code> screen was designed with mouse and keyboard in mind, without support for controller navigation.</p>
<p>For mouse input, use <a href="https://doc.qt.io/qt-6/qml-qtquick-mousearea.html">MouseArea</a> or <a href="https://doc.qt.io/qt-6/qml-qtquick-taphandler.html">TapHandler</a>.</p>
<p>For keyboard input, use <a href="https://doc.qt.io/qt-6/qml-qtquick-keys.html">Keys</a></p>
<p>For bound key input (controller or keyboard), use <a href="https://bobini1.github.io/RhythmGame/classqml__components_1_1InputAttached.html">Input</a>.</p>
<p><code>sceneStack</code> automatically disables all input for screens that are not at the top of the stack. Make sure to disable any background sounds and <a href="https://doc.qt.io/qt-6/qml-qtquick-shortcut.html">Shortcuts</a> when pushing a new screen on top of the stack (Shortcuts are dumb and don't get disabled automatically). Song preview should not play during gameplay. You can use the <a href="https://doc.qt.io/qt-6/qml-qtquick-item.html#enabled-prop">enabled</a> property of <code>Item</code> to detect when a screen is not active. This property propagates to all child components.</p>
<p>Gameplay screens should not use <code>Input</code> directly. Instead, use <a href="https://bobini1.github.io/RhythmGame/classgameplay__logic_1_1ColumnState.html#a116fbd7d8aec0c9ebad00828b7564ab6">columnState.pressed</a>. This will play nicely with autoplay and replays. <code>Input</code> is reserved for actual input, not injected key presses.</p>
<h2><a class="anchor" id="autotoc_md37"></a>
Scaling</h2>
<p>Your theme is expected to work on all screen sizes and aspect ratios. There are two ways you can achieve that.</p><ul>
<li>Use <a href="https://doc.qt.io/qt-6/qtquicklayouts-overview.html">layouts</a> to dynamically set the sizes of elements based on the size of their parents.</li>
<li>Use fixed, hard-coded component sizes and <a href="https://doc.qt.io/qt-6/qml-qtquick-item.html#scale-prop">rescale</a> the top item to fit the size of the window.</li>
</ul>
<p>In the default theme, you can see the first approach in the <code>settings</code> screen. All other screens use scaling. In general, scaling is easier to use.</p>
<p>Please try resizing the window of the game when testing your theme edits.</p>
<h2><a class="anchor" id="autotoc_md38"></a>
The Rg singleton</h2>
<p>The <a href="https://bobini1.github.io/RhythmGame/classRg.html">Rg</a> singleton is globally accessible upon importing <code>RhythmGameQml</code>. It contains various API objects with methods and properties useful for themes. You will probably use it a lot! Start reading the docs there. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
